{% extends "admin/base.html" %}

{% block title %}Skills Management - Admin Panel{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Skills Management</h2>
    <a href="{{ url_for('admin.new_skill') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add New Skill
    </a>
</div>

<!-- Stats Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="mb-0">{{ skills.total }}</h4>
                        <p class="mb-0">Total Skills</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-code fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="mb-0">{{ skills.items|selectattr('category', 'equalto', 'Programming')|list|length }}</h4>
                        <p class="mb-0">Programming</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-laptop-code fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="mb-0">{{ skills.items|selectattr('category', 'equalto', 'Framework')|list|length }}</h4>
                        <p class="mb-0">Frameworks</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-layer-group fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="mb-0">{{ skills.items|selectattr('category', 'equalto', 'Tool')|list|length }}</h4>
                        <p class="mb-0">Tools</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-tools fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Filters and Search -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-4">
                <label for="category" class="form-label">Filter by Category</label>
                <select name="category" id="category" class="form-select">
                    <option value="">All Categories</option>
                    <option value="Programming" {{ 'selected' if request.args.get('category') == 'Programming' }}>Programming Languages</option>
                    <option value="Framework" {{ 'selected' if request.args.get('category') == 'Framework' }}>Frameworks & Libraries</option>
                    <option value="Database" {{ 'selected' if request.args.get('category') == 'Database' }}>Databases</option>
                    <option value="Tool" {{ 'selected' if request.args.get('category') == 'Tool' }}>Tools & Software</option>
                    <option value="Other" {{ 'selected' if request.args.get('category') == 'Other' }}>Other</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="proficiency" class="form-label">Filter by Proficiency</label>
                <select name="proficiency" id="proficiency" class="form-select">
                    <option value="">All Levels</option>
                    <option value="90" {{ 'selected' if request.args.get('proficiency') == '90' }}>Expert (90%+)</option>
                    <option value="70" {{ 'selected' if request.args.get('proficiency') == '70' }}>Advanced (70%+)</option>
                    <option value="50" {{ 'selected' if request.args.get('proficiency') == '50' }}>Intermediate (50%+)</option>
                    <option value="30" {{ 'selected' if request.args.get('proficiency') == '30' }}>Beginner (30%+)</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="search" class="form-label">Search Skills</label>
                <div class="input-group">
                    <input type="text" name="search" id="search" class="form-control" placeholder="Search by name..." value="{{ request.args.get('search', '') }}">
                    <button type="submit" class="btn btn-outline-secondary">
                        <i class="fas fa-search"></i>
                    </button>
                    {% if request.args %}
                    <a href="{{ url_for('admin.skills') }}" class="btn btn-outline-danger">
                        <i class="fas fa-times"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Skills Grid -->
{% if skills.items %}
<div class="row">
    {% for skill in skills.items %}
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100 skill-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="flex-grow-1">
                        <h5 class="card-title mb-1">{{ skill.name }}</h5>
                        <span class="badge bg-{{ 'primary' if skill.category == 'Programming' else 'success' if skill.category == 'Framework' else 'info' if skill.category == 'Database' else 'warning' if skill.category == 'Tool' else 'secondary' }}">{{ skill.category }}</span>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('admin.edit_skill', id=skill.id) }}"><i class="fas fa-edit"></i> Edit</a></li>
                            <li><a class="dropdown-item text-danger" href="{{ url_for('admin.delete_skill', id=skill.id) }}" onclick="return confirm('Are you sure?')"><i class="fas fa-trash"></i> Delete</a></li>
                        </ul>
                    </div>
                </div>
                
                <!-- Proficiency Bar -->
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <small class="text-muted">Proficiency</small>
                        <small class="fw-bold">{{ skill.proficiency }}%</small>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-{{ 'success' if skill.proficiency >= 80 else 'info' if skill.proficiency >= 60 else 'warning' if skill.proficiency >= 40 else 'danger' }}" 
                             role="progressbar" 
                             style="width: {{ skill.proficiency }}%" 
                             aria-valuenow="{{ skill.proficiency }}" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                        </div>
                    </div>
                </div>
                
                {% if skill.description %}
                <p class="card-text text-muted small">{{ skill.description[:100] }}{% if skill.description|length > 100 %}...{% endif %}</p>
                {% endif %}
                
                <!-- Years of Experience -->
                {% if skill.years_experience %}
                <div class="d-flex align-items-center mb-2">
                    <i class="fas fa-calendar-alt text-muted me-2"></i>
                    <small class="text-muted">{{ skill.years_experience }} year{{ 's' if skill.years_experience != 1 else '' }} experience</small>
                </div>
                {% endif %}
                
                <!-- Icon Display -->
                {% if skill.icon %}
                <div class="text-center mt-3">
                    <i class="{{ skill.icon }} fa-2x text-primary"></i>
                </div>
                {% endif %}
            </div>
            
            <div class="card-footer bg-transparent">
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">Order: {{ skill.order_index or 0 }}</small>
                    <div>
                        <a href="{{ url_for('admin.edit_skill', id=skill.id) }}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <a href="{{ url_for('admin.delete_skill', id=skill.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this skill?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if skills.pages > 1 %}
<nav aria-label="Skills pagination">
    <ul class="pagination justify-content-center">
        {% if skills.has_prev %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('admin.skills', page=skills.prev_num, **request.args) }}">
                    <i class="fas fa-chevron-left"></i> Previous
                </a>
            </li>
        {% endif %}
        
        {% for page_num in skills.iter_pages() %}
            {% if page_num %}
                {% if page_num != skills.page %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('admin.skills', page=page_num, **request.args) }}">{{ page_num }}</a>
                    </li>
                {% else %}
                    <li class="page-item active">
                        <span class="page-link">{{ page_num }}</span>
                    </li>
                {% endif %}
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            {% endif %}
        {% endfor %}
        
        {% if skills.has_next %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('admin.skills', page=skills.next_num, **request.args) }}">
                    Next <i class="fas fa-chevron-right"></i>
                </a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<!-- Empty State -->
<div class="text-center py-5">
    <i class="fas fa-code fa-4x text-muted mb-3"></i>
    <h4 class="text-muted">No Skills Found</h4>
    <p class="text-muted mb-4">
        {% if request.args %}
            No skills match your current filters. Try adjusting your search criteria.
        {% else %}
            You haven't added any skills yet. Start by adding your first skill!
        {% endif %}
    </p>
    <div>
        {% if request.args %}
        <a href="{{ url_for('admin.skills') }}" class="btn btn-outline-secondary me-2">
            <i class="fas fa-times"></i> Clear Filters
        </a>
        {% endif %}
        <a href="{{ url_for('admin.new_skill') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Your First Skill
        </a>
    </div>
</div>
{% endif %}

<!-- Bulk Actions Modal -->
<div class="modal fade" id="bulkActionsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Bulk Actions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Select an action to perform on selected skills:</p>
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-outline-danger" onclick="bulkDelete()">
                        <i class="fas fa-trash"></i> Delete Selected
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="bulkUpdateCategory()">
                        <i class="fas fa-tags"></i> Update Category
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Skill card hover effects
document.addEventListener('DOMContentLoaded', function() {
    const skillCards = document.querySelectorAll('.skill-card');
    
    skillCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.transition = 'transform 0.3s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});

// Auto-submit form on filter change
document.getElementById('category').addEventListener('change', function() {
    this.form.submit();
});

document.getElementById('proficiency').addEventListener('change', function() {
    this.form.submit();
});

// Search functionality
let searchTimeout;
document.getElementById('search').addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        this.form.submit();
    }, 500);
});
</script>
{% endblock %}

{% block styles %}
<style>
.skill-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid #dee2e6;
}

.skill-card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.progress {
    background-color: #e9ecef;
}

.card-footer {
    border-top: 1px solid #dee2e6;
}

.badge {
    font-size: 0.75em;
}

@media (max-width: 768px) {
    .col-md-6 {
        margin-bottom: 1rem;
    }
}
</style>
{% endblock %}