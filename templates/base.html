<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ site_settings.get('site_name', 'Muhammad Hanzala') }} - Portfolio{% endblock %}</title>

    <!-- Theme Init (Critical Path) -->
    <script>
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="{% block meta_description %}Professional Portfolio of {{ site_settings.get('site_name', 'Muhammad Hanzala') }} - {{ site_settings.get('tagline', 'Full Stack Developer') }}{% endblock %}">
    <meta name="keywords"
        content="{{ site_settings.get('site_name', 'Muhammad Hanzala') }}, Hani, Full Stack Developer, Python, Flask, React, 3D Design, Portfolio">
    <meta name="author" content="{{ site_settings.get('site_name', 'Muhammad Hanzala') }}">
    <meta name="robots" content="index, follow">

    <!-- Open Graph -->
    <meta property="og:title" content="{{ site_settings.get('site_name', 'Muhammad Hanzala') }} | Full Stack Developer">
    <meta property="og:description" content="{{ site_settings.get('tagline', 'Digital Creator') }}">
    <meta property="og:image" content="{{ url_for('static', filename='img/og-preview.jpg', _external=True) }}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:type" content="website">

    <!-- Twitter SEO -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Muhammad Hanzala | Digital Creator">
    <meta name="twitter:description" content="Scalable apps and stunning 3D visuals.">
    <meta name="twitter:image" content="{{ url_for('static', filename='img/og-preview.jpg', _external=True) }}">

    <!-- Fonts - Inter (Professional) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Swiper CSS (moved from body) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">

    <!-- Design System CSS (loads AFTER Bootstrap to override) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/digital_alchemy.css') }}">

    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register("{{ url_for('static', filename='sw.js') }}")
                    .then(registration => {
                        console.log('PWA ServiceWorker registered: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('PWA ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>

    <!-- Theme Init Moved to Top -->

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "{{ site_settings.get('site_name', 'Muhammad Hanzala') }}",
      "url": "{{ request.url_root }}",
      "sameAs": [
        "https://www.linkedin.com/in/muhammad-hanzala-47439328a/",
        "https://github.com/Muhammad-Hanzala103"
      ],
      "jobTitle": "Full Stack Developer",
      "worksFor": {
        "@type": "Organization",
        "name": "Freelance"
      }
    }
    </script>
    <!-- Removed broken SearchAction JSON-LD (no /search route exists) -->

    {% block extra_css %}{% endblock %}
</head>

<body class="loading">
    <!-- Preloader -->
    <div id="preloader">
        <div class="loader"></div>
    </div>

    <!-- 3D Background Container -->
    <div id="vanta-bg"></div>

    <!-- Navigation -->
    <nav class="glass-nav">
        <div class="nav-container">
            <a href="{{ url_for('main.index') }}" class="logo">Muhammad Hanzala</a>

            <div class="d-flex align-items-center gap-3">
                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <div class="nav-links" id="navLinks">
                <a href="{{ url_for('main.index') }}"
                    class="{% if request.endpoint == 'main.index' %}active{% endif %}">Home</a>
                <a href="{{ url_for('main.projects') }}"
                    class="{% if request.endpoint == 'main.projects' %}active{% endif %}">Projects</a>
                <a href="{{ url_for('main.about') }}"
                    class="{% if request.endpoint == 'main.about' %}active{% endif %}">About</a>
                <a href="{{ url_for('main.services') }}"
                    class="{% if request.endpoint == 'main.services' %}active{% endif %}">Services</a>
                <a href="{{ url_for('main.blog') }}"
                    class="{% if request.endpoint == 'main.blog' %}active{% endif %}">Blog</a>
                <a href="{{ url_for('main.gallery') }}"
                    class="{% if request.endpoint == 'main.gallery' %}active{% endif %}">Gallery</a>
                <a href="{{ url_for('main.contact') }}" class="btn-alchemy">Contact</a>

                <!-- Theme Toggle (Desktop) -->
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle Theme">
                    <i class="fas fa-sun"></i>
                </button>

                <!-- Auth Buttons -->
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('admin.dashboard') }}" class="nav-auth-btn"><i class="fas fa-tachometer-alt"></i>
                    Admin</a>
                <a href="{{ url_for('admin.admin_logout') }}" class="nav-auth-btn"
                    style="background: var(--accent-error) !important;"><i class="fas fa-sign-out-alt"></i> Logout</a>
                {% else %}
                <a href="{{ url_for('admin.admin_login') }}" class="nav-auth-btn"><i class="fas fa-sign-in-alt"></i>
                    Login</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="container" style="padding-top: 100px;">
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">
                <i
                    class="fas {% if category == 'success' %}fa-check-circle{% elif category == 'danger' %}fa-exclamation-circle{% elif category == 'warning' %}fa-exclamation-triangle{% else %}fa-info-circle{% endif %}"></i>
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <!-- Newsletter Section (Pre-Footer) -->
    <section class="section" style="background: var(--bg-tertiary);">
        <div class="container">
            <div class="glass-panel p-5 text-center"
                style="border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
                <div class="row align-items-center">
                    <div class="col-lg-6 text-lg-start mb-4 mb-lg-0">
                        <h2 class="mb-2">Stay in the Loop</h2>
                        <p class="text-muted mb-0">Get notified about my latest projects, tech articles, and digital
                            experiments.</p>
                    </div>
                    <div class="col-lg-6">
                        <form action="{{ url_for('main.newsletter_signup') }}" method="POST" class="d-flex gap-2">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="email" name="email"
                                class="form-control form-control-lg bg-white bg-opacity-10 border-secondary text-white rounded-pill ps-4"
                                placeholder="Enter your email" required>
                            <button type="submit" class="btn btn-primary btn-lg rounded-pill px-5">Join</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Professional Industrial Footer -->
    <footer class="footer pt-5 pb-3">
        <div class="container">
            <div class="row g-5">
                <!-- Branding & About -->
                <div class="col-lg-4 col-md-6">
                    <div class="footer-brand mb-4">
                        <span class="gradient-text h3 fw-bold">{{ site_settings.get('site_name', 'Muhammad Hanzala')
                            }}</span>
                        <p class="text-muted mt-3">{{ site_settings.get('bio_lead', 'Crafting high-performance digital
                            experiences and scalable solutions.') }}</p>
                    </div>
                    <div class="social-links d-flex gap-3">
                        <a href="{{ site_settings.get('github_url', 'https://github.com/Muhammad-Hanzala103') }}" target="_blank" class="social-icon"><i class="fab fa-github"></i></a>
                        <a href="{{ site_settings.get('linkedin_url', 'https://www.linkedin.com/in/muhammad-hanzala-47439328a/') }}" target="_blank" class="social-icon"><i class="fab fa-linkedin"></i></a>
                        <a href="{{ site_settings.get('fiverr_url', 'https://www.fiverr.com/mr0_0hani') }}" target="_blank" class="social-icon"><i class="fas fa-shopping-bag"></i></a>
                        <a href="mailto:{{ site_settings.get('email', 'hani75384@gmail.com') }}" class="social-icon"><i class="fas fa-envelope"></i></a>
                    </div>
                </div>

                <!-- Quick Links -->
                <div class="col-lg-3 col-md-4 col-12">
                    <h5 class="mb-4 text-white fw-bold">Navigation</h5>
                    <ul class="list-unstyled footer-links">
                        <li class="mb-3"><a href="{{ url_for('main.index') }}"
                                class="text-white-50 text-decoration-none hover-white transition-base d-flex align-items-center"><i
                                    class="fas fa-chevron-right small me-2 opacity-50"></i> Home</a></li>
                        <li class="mb-3"><a href="{{ url_for('main.projects') }}"
                                class="text-white-50 text-decoration-none hover-white transition-base d-flex align-items-center"><i
                                    class="fas fa-chevron-right small me-2 opacity-50"></i> Portfolio</a>
                        </li>
                        <li class="mb-3"><a href="{{ url_for('main.services') }}"
                                class="text-white-50 text-decoration-none hover-white transition-base d-flex align-items-center"><i
                                    class="fas fa-chevron-right small me-2 opacity-50"></i> Services</a></li>
                        <li class="mb-3"><a href="{{ url_for('main.blog') }}"
                                class="text-white-50 text-decoration-none hover-white transition-base d-flex align-items-center"><i
                                    class="fas fa-chevron-right small me-2 opacity-50"></i> Blog</a></li>
                    </ul>
                </div>

                <!-- Professional Platforms -->
                <div class="col-lg-3 col-md-4 col-12">
                    <h5 class="mb-4 text-white fw-bold">Ecosystem</h5>
                    <ul class="list-unstyled footer-links">
                        <li class="mb-3"><a href="https://www.fiverr.com/mr0_0hani" target="_blank"
                                class="text-white-50 text-decoration-none hover-white transition-base d-flex align-items-center"><i
                                    class="fas fa-external-link-alt small me-2 opacity-50"></i> Fiverr Pro</a>
                        </li>
                        <li class="mb-3"><a href="https://www.upwork.com/" target="_blank"
                                class="text-white-50 text-decoration-none hover-white transition-base d-flex align-items-center"><i
                                    class="fas fa-external-link-alt small me-2 opacity-50"></i> Upwork Talent</a>
                        </li>
                        <li class="mb-3"><a href="{{ url_for('main.gallery') }}"
                                class="text-white-50 text-decoration-none hover-white transition-base d-flex align-items-center"><i
                                    class="fas fa-image small me-2 opacity-50"></i> Design
                                Gallery</a></li>
                        <li class="mb-3"><a href="{{ url_for('main.about') }}"
                                class="text-white-50 text-decoration-none hover-white transition-base d-flex align-items-center"><i
                                    class="fas fa-user small me-2 opacity-50"></i> About Me</a></li>
                    </ul>
                </div>

                <!-- Contact Info -->
                <div class="col-lg-2 col-md-4 col-12">
                    <h5 class="mb-4">Contact Details</h5>
                    <ul class="list-unstyled footer-contact">
                        <li><i class="fas fa-map-marker-alt text-primary me-2"></i> {{ site_settings.get('location',
                            'Islamabad, Pakistan') }}</li>
                        <li><i class="fas fa-phone text-primary me-2"></i> {{ site_settings.get('phone', '+92 301
                            5855940') }}</li>
                        <li><i class="fas fa-envelope text-primary me-2"></i> {{ site_settings.get('email',
                            'hani75384@gmail.com') }}</li>
                    </ul>
                    <div class="mt-4">
                        <a href="{{ url_for('main.download_cv') }}"
                            class="btn btn-outline-primary btn-sm rounded-pill w-100">
                            <i class="fas fa-download me-2"></i> Download Professional CV
                        </a>
                    </div>
                </div>
            </div>

            <hr class="my-5 border-secondary opacity-10">

            <div class="footer-bottom text-center">
                <p class="text-muted small mb-0">&copy; {{ now.year }} {{ site_settings.get('site_name', 'Muhammad
                    Hanzala') }}. All Rights Reserved.
                    <a href="{{ url_for('main.privacy') }}" class="text-muted ms-2 text-decoration-none">Privacy</a> â€¢
                    <a href="{{ url_for('main.terms') }}" class="text-muted ms-1 text-decoration-none">Terms</a>
                </p>
                <p class="text-muted small mt-2">Crafted
                    with <i class="fas fa-heart text-danger"></i> & <i class="fab fa-python text-primary"></i></p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle (required for accordion, collapse, etc.) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <script>
        // Preloader
        window.addEventListener('load', () => {
            document.body.classList.add('loaded');
            document.body.classList.remove('loading');
        });

        // Theme Toggle Logic
        const themeToggle = document.getElementById('themeToggle');
        const themeToggleMobile = document.getElementById('themeToggleMobile');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');
        const iconMobile = themeToggleMobile?.querySelector('i');

        function setTheme(theme) {
            html.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            const iconClass = theme === 'light' ? 'fa-moon' : 'fa-sun';
            icon.className = `fas ${iconClass}`;
            if (iconMobile) iconMobile.className = `fas ${iconClass}`;

            // Re-init Vanta if exists (to change colors)
            if (window.vantaEffect) {
                window.vantaEffect.setOptions({
                    backgroundColor: theme === 'light' ? 0xf8fafc : 0x23232e,
                    color: theme === 'light' ? 0x6366f1 : 0x6366f1
                });
            }
        }

        // Init Theme
        const currentTheme = localStorage.getItem('theme') || 'dark';
        setTheme(currentTheme);

        [themeToggle, themeToggleMobile].forEach(btn => {
            if (btn) {
                btn.addEventListener('click', () => {
                    const newTheme = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                    setTheme(newTheme);
                });
            }
        });

        // Vanta.js Init (Global Background)
        try {
            window.vantaEffect = VANTA.NET({
                el: "#vanta-bg",
                mouseControls: true,
                touchControls: true,
                gyroControls: false,
                minHeight: 200.00,
                minWidth: 200.00,
                scale: 1.00,
                scaleMobile: 1.00,
                color: 0x6366f1,
                backgroundColor: currentTheme === 'light' ? 0xf8fafc : 0x16161d,
                points: 15.00,
                maxDistance: 24.00,
                spacing: 16.00,
                showDots: false
            });
        } catch (e) {
            console.log("Vanta JS failed to load", e);
        }

        gsap.registerPlugin(ScrollTrigger);

        // Mobile Menu Toggle
        const hamburger = document.getElementById('hamburger');
        const navLinks = document.getElementById('navLinks');
        if (hamburger && navLinks) {
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
            });
            // Close menu on link click
            navLinks.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                });
            });
        }

        // Global Animations
        gsap.from(".reveal-text", {
            y: 30,
            opacity: 0,
            duration: 1,
            stagger: 0.1,
            ease: "power3.out",
            scrollTrigger: {
                trigger: "main",
                start: "top 80%"
            }
        });
    </script>
    {% block extra_js %}{% endblock %}
</body>

</html>